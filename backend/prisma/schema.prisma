// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init


generator client {
  provider        = "prisma-client-js" 

}
datasource db{
   provider = "postgresql"
}





model User {
  id            String        @id @default(cuid())
  email         String        @unique
  password      String?
  name          String?
  avatar        String?
  avatarCloudId String?
  role          Role          @default(FREE_USER)
  plan          Plan          @default(FREE)
  tokensUsed    Int           @default(0)
  isBlock      Boolean       @default(false)
  deletedAt DateTime?
  isActive  Boolean  @default(true)
  monthlyLimit  Int           @default(100) 
  documents     Document[]

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  chat          ChatMessage[]
  providers     UserProvider[]
  sessions        Session[]

}

model Session {
  id           String   @id @default(cuid())
  userId       String
  refreshToken String   @unique
  userAgent    String?
  ipAddress    String?
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model UserProvider {
  id          String        @id @default(cuid())
  userId      String
  provider    AuthProvider
  providerId  String?       
  user        User          @relation(fields: [userId], references: [id])

  @@unique([provider, providerId])
}

enum AuthProvider {
  GOOGLE
}



model Document {
  id             String        @id @default(cuid())
  userId         String
  user           User          @relation(fields: [userId], references: [id],onDelete: Cascade)
  title          String
  fileName       String
  fileUrl        String
  cloudinaryId   String?
  fileSize       String
  pages          Int
  extractedText  String?
  summary        String?
  embeddings     Boolean       @default(false)
  flashcards     Flashcard[]
  quizzes        Quiz[]
  chats          ChatMessage[]
  processing     ProcessingStatus @default(PENDING)
  processedAt    DateTime?
  createdAt      DateTime      @default(now())
}

model Flashcard {
  id          String   @id @default(cuid())
  documentId  String
  document    Document @relation(fields: [documentId], references: [id])
  front       String
  back        String
  category    String
  difficulty  Difficulty @default(MEDIUM)
  createdAt   DateTime @default(now())
}

model Quiz {
  id          String     @id @default(cuid())
  documentId  String
  document    Document   @relation(fields: [documentId], references: [id])
  title       String
  questions   Json
  score       Float?
  completedAt DateTime?
  createdAt   DateTime   @default(now())
}

model ChatMessage {
  id         String   @id @default(cuid())
  documentId String
  document   Document @relation(fields: [documentId], references: [id])
  userId     String
  user       User     @relation(fields: [userId], references: [id],onDelete:Cascade)
  role       ChatRole @default(USER)
  content    String
  createdAt  DateTime @default(now())
}

// Enums
enum Role {
  ADMIN
  FREE_USER
  PREMIUM_USER
}

enum Plan {
  FREE
  BASIC
  PREMIUM
  ENTERPRISE
}

enum ProcessingStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum ChatRole {
  USER
  ASSISTANT
  SYSTEM
}

